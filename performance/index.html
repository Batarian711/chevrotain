<!DOCTYPE html>
<html>
<head lang="en">
    <link rel="stylesheet" type="text/css" href="style.css">
    <meta charset="UTF-8">

    <title></title>
</head>
<body>

<script src="../bower_components/lodash/lodash.js"></script>
<script src="../bower_components/benchmark/benchmark.js"></script>
<script src="../bower_components/chevrotain/release/chevrotain.js"></script>
<script src="samples/10K_json.js"></script>

<script src="jsonParsers/chevrotain/chevrotainParser.js"></script>
<script src="jsonParsers/chevrotain/api.js"></script>

<script src="jsonParsers/jison/jisonParser.js"></script>

<script src="jsonParsers/pegjs/pegjs_jison_parser.js"></script>
<div align="center" class="card center">
    <section style="text-align:left;">
        <h1>Performance comparison of three Javascript Parsing generators/framework</h1>

        <p>Each Tool was used to implement a JSON Parser:</p>
        <ol>
            <li><p><a rel="nofollow" href="http://zaach.github.io/jison/">Jison</a> parser Generator
                <a rel="nofollow"
                   href="https://github.com/sap/chevrotain/blob/gh-pages/performance/jsonParsers/jison/jsonParserGrammar.js">grammar</a>
                <a rel="nofollow"
                   href="https://github.com/sap/chevrotain/blob/gh-pages/performance/jsonParsers/jison/jisonParser.js">generated
                    code</a></p></li>
            <li><p><a rel="nofollow" href="https://github.com/SAP/chevrotain">Chevrotain</a> parsing DSL
                <a rel="nofollow"
                   href="https://github.com/sap/chevrotain/blob/gh-pages/performance/jsonParsers/chevrotain/chevrotainParser.js">implementation</a>
            </p></li>
            <li><p>
                <a rel="nofollow" href="http://pegjs.org/">PEG.js</a> parser Generator
                <a rel="nofollow"
                   href="https://github.com/sap/chevrotain/blob/gh-pages/performance/jsonParsers/pegjs/json.pegjs">grammar</a>
                <a rel="nofollow"
                   href="https://github.com/sap/chevrotain/blob/gh-pages/performance/jsonParsers/pegjs/pegjs_jison_parser.js">generated
                    code</a>
            </p></li>
        </ol>
        <p>The input <a rel="nofollow" href="https://github.com/sap/chevrotain/blob/gh-pages/performance/samples/10K_json.js">sample</a> for
            the benchmark is a ~10,000 lines JSON file generated by
            <a rel="nofollow" href="http://www.json-generator.com/">json-generator</a>.
            <br>
            All three parsers have no output(build no AST), they only parse the text (without errors)</p>

        <p>The entire code for this test can be found in this github
            <a rel="nofollow" href="https://github.com/sap/chevrotain/tree/gh-pages/performance">repo</a>.
        </p>
    </section>
    <section style="text-align:left;">
        <span id="wait" style="margin-left: auto;margin-right: auto;">Running</span>
        <table id="resultsTable">
            <tr>
                <td style="font-weight: bold">Parser Generator Configuration</td>
                <td style="font-weight: bold">ops/second</td>
                <td style="font-weight: bold">Number of Iterations</td>
            </tr>
        </table>
        <p id="fastestInResults"></p>
    </section>
</div>
<script>
    var dots = window.setInterval(function () {
        var wait = document.getElementById("wait");
        var valueBeforeTheDots = "Running";
        if (wait.innerHTML.length > valueBeforeTheDots.length + 3)
            wait.innerHTML = "Running";
        else
            wait.innerHTML += ".";
    }, 500);
    var suite = new Benchmark.Suite;
    suite
            .add('Jison Generated Parser + lexer', function () {
                jisonJsonLexerAndParser.parse(json_sample10k)
            }).add('pegjs generated parser + lexer', function () {
                pegjsJsonLexerAndParser.parse(json_sample10k)
            }).add('Chevrotain lexer + parser', function () {
                chevrotainParseWithChevrotainLexer(json_sample10k)
            }).on('cycle', function (event) {
                console.log(String(event.target));
                // Find a <table> element with id="resultsTable":
                var table = document.getElementById("resultsTable");

                // Create an empty <tr> element and add it to the 1st position of the table:
                var row = table.insertRow(-1);

                // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
                var cell1 = row.insertCell(0);
                var cell2 = row.insertCell(1);
                var cell3 = row.insertCell(2);

                // Add some text to the new cells:
                cell1.innerHTML = event.target.name;
                cell2.innerHTML = event.target.hz.toFixed(2) + "    " + "\xB1" + event.target.stats.rme.toFixed(2) + "%";
                cell3.innerHTML = event.target.stats.sample.length + " samples ran";
            }).on('complete', function () {
                var sFastest = 'Fastest is ' + this.filter('fastest').pluck('name');
                console.log(sFastest);
                document.getElementById("fastestInResults").innerHTML = sFastest;
                window.clearInterval(dots);
                document.getElementById("wait").innerHTML = "";
            }).run({'async': true});

</script>
</body>
</html>
<!DOCTYPE html>
<html>
<head lang="en">
    <link rel="icon"
          type="image/jpeg"
          href="../photos/chevrotain.jpg">
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="CSS/playground.css">
    <link rel="stylesheet" type="text/css" href="CSS/railroad-diagrams.css">
    <link rel="stylesheet" href="../bower_components/CodeMirror/lib/codemirror.css">

    <script>
        // expose the whole Chevrotain's API including the 'private' parts to allow cleaning the the cache.
        window.CHEV_TEST_MODE = true
    </script>
    <script src="../bower_components/lodash/lodash.js"></script>
    <script src="../bower_components/jquery/dist/jquery.js"></script>
    <script src="libs/jquery.svg.js"></script>
    <script src="libs/jquery.svgdom.js"></script>
    <script src="../bower_components/chevrotain/release/chevrotain.js"></script>
    <script src="../bower_components/CodeMirror/lib/codemirror.js"></script>
    <script src="../bower_components/CodeMirror/mode/javascript/javascript.js"></script>
    <script src="RailRoadDiagreams/railroad-diagrams.js"></script>
    <script src="editors.js"></script>
    <script src="errorMarkers.js"></script>
    <script src="examples.js"></script>
    <script src="syntaxBuilding.js"></script>
    <script src="diagramsHighlights.js"></script>
    <title>Playground</title>
</head>
<body style="background-color: #f1f1f1">

<div align="center">
    <div class="leftPart">
        <div class="card">

            <div align="center">
                <h1 style="float: left;">Implementation</h1>

                <div style="float: right; margin-top: 7px;">
                    <h3 style="float: left; margin-top: 4px">Example:</h3>
                    <label for="example-choice"></label><select id="example-choice"
                                                                style="float: left; margin-left: 8px; margin-right: 8px; margin-top: 2px;"></select>
                </div>
                <div style="clear:both;"></div>
                <hr class="hrInCardHeader">
                <div id="errorMessagesDiv"></div>
            </div>

            <div class="textareawrapper">
                <label for="parserImplementationEditor"></label>
                <textarea id="parserImplementationEditor"></textarea>
            </div>
        </div>

        <div align="center" class="card">
            <h1 style="float: left">Input</h1>

            <div style="float: right; margin-top: 7px;">
                <h3 style="float: left; margin-top: 4px">Sample:</h3>
                <label for="samples-choice"></label><select id="samples-choice"
                                                            style="float: left; margin-left: 8px; margin-right: 8px; margin-top: 2px;"></select>
            </div>
            <div style="clear:both;"></div>
            <hr class="hrInCardHeader">
            <div class="textareawrapper">
                <label for="parserInputEditor"></label><textarea id="parserInputEditor" class="textArea" rows="6" cols="100"
                                                           spellcheck="false"></textarea>
            </div>
        </div>


    </div>
    <div class="rightPart">
        <div class="card">
            <div align="center">
                <h1 style="float: left">Syntax Diagrams</h1>
            </div>
            <div style="clear:both;"></div>
            <hr class="hrInCardHeader">
            <div id="diagramsDiv" class="diagramsDiv"></div>
        </div>
        <div class="card">
            <h1 style="float: left">Output</h1>

            <div style="clear:both;"></div>
            <hr class="hrInCardHeader">
            <div class="textareawrapper">
                <label for="parserOutput"></label><textarea id="parserOutput" class="textArea" rows="10" cols="100" spellcheck="false"
                                                            readonly></textarea>
            </div>
        </div>
    </div>
    <div style="clear:both;"></div>
</div>


<script>
    // global state
    var lexer = null
    var parser = null
    var defaultRuleName = null
    var javaScriptEditor = null
    var inputEditor = null
    var inputEditorMarkers = []
    var lexerErrorsMarkers = []
    var parserErrorsMarkers = []
    var examplesDropdown = null
    var samplesDropdown = null
    var parserOutput = null
    var diagramsDiv = null


    $(document).ready(function init() {
        // defer error handling so we can display error markers visually
        // instead of using the default chevrotain behavior of throwing exceptions.
        chevrotain.Parser.DEFER_DEFINITION_ERRORS_HANDLING = true

        // init global state
        examplesDropdown = $("#example-choice")
        samplesDropdown = $("#samples-choice")
        parserOutput = $("#parserOutput")
        diagramsDiv = _.first($("#diagramsDiv"))

        var implTextArea = $("#parserImplementationEditor")
        javaScriptEditor = CodeMirror.fromTextArea(_.first(implTextArea), {
            lineNumbers   : true,
            viewportMargin: 35
        })
        javaScriptEditor.setSize("100%", "33rem")
        javaScriptEditor.on("change", _.debounce(onImplementationEditorContentChange, 250))

        inputEditor = CodeMirror.fromTextArea(_.first($("#parserInputEditor")), {
            lineNumbers: true
        })
        inputEditor.setSize("100%", "100%") // 100% height to auto adjust to contents
        inputEditor.on("change", _.debounce(onInputEditorContentChange, 250))

        // Workaround... I don't know why the text is aligned center by default...
        $(".CodeMirror").css({"text-align": "left"})

        initExamplesDropDown(examplesDropdown)
        examplesDropdown.change(function () {
            loadExample(examplesDropdown.val())
        })

        loadExample("json", true)
        updateSamplesDropDown()

        samplesDropdown.change(function () {
            loadSamples(samplesDropdown.val())
        })
    })
</script>

</body>
</html>

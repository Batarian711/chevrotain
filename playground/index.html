<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <!-- Style Sheets -->
    <link rel="stylesheet" type="text/css" href="CSS/playground.css">
    <link rel="stylesheet" type="text/css" href="CSS/railroad-diagrams.css">
    <!-- Libraries -->
    <script>
        // expose even the Chevrotain's 'private' API to allow cleaning the the cache.
        window.CHEV_TEST_MODE = true
    </script>
    <script src="../bower_components/jquery/dist/jquery.js"></script>
    <script src="../bower_components/lodash/lodash.js"></script>
    <script src="../bower_components/chevrotain/release/chevrotain.js"></script>
    <script src="RailRoadDiagreams/railroad-diagrams.js"></script>
    <script src="syntaxBuilding.js"></script>
    <title>Playground</title>
</head>
<body style="background-color: #f1f1f1">

<div align="center">
    <div class="leftPart">
        <div class="card">
            <div align="center">
                <h1>Parser Code</h1>
            </div>

            <div class="textareawrapper">
                <label for="parserCodeAreaID"></label>
                <textarea class="textArea" id="parserCodeAreaID" rows="25"
                          cols="100"
                          spellcheck="false"></textarea>
            </div>

            <div align="center">
                <h1>Try Your Parser</h1>
            </div>
            <div class="textareawrapper">
            <textarea class="textArea" rows="25" cols="100"
                      spellcheck="false" placeholder="Coming Soon!!"></textarea>
            </div>
        </div>
    </div>
    <div class="rightPart">
        <div class="card">
            <div align="center">
                <h1 style="float: left">Syntax Diagrams</h1>
                <button id="refreshSyntaxDiagrams" style="float: left;margin-top: 16px;margin-left: 12px;">Refresh</button>
                    <label><input type='checkbox' id="nameOrRegExp" onclick='addSvgDiagrams(!this.checked);'>Show Terminal's RegExp</label>
            </div>
            <div style="clear:both;"></div>
            <div id="svgWrapperId" class="svgWrapper"></div>
        </div>
    </div>
    <div style="clear:both;"></div>
</div>


<script>

    function cleanCache() {
        var hashmaps = _.filter(chevrotain.cache, function (prop) {
            return prop.hasOwnProperty("_state")
        })

        _.forEach(hashmaps, function (cacheMap) {
            cacheMap._state = {}
        })
    }

    function addSvgDiagrams(useTokenNames) {
        cleanCache()
        var svgWrapperDiv = document.getElementById("svgWrapperId")
        svgWrapperDiv.innerHTML = ""
        var parserConstructor = eval($("#parserCodeAreaID").val())
        var parser = new parserConstructor()
        var topRules = parser.getGAstProductions().values()
        _.forEach(topRules, function (production) {
            document.getElementById("svgWrapperId").innerHTML += convertProductionToDiagram(production, useTokenNames)
        })
    }

    $(document).ready(function () {
        $.ajax({
            url     : "DefaultParserCodeValue.txt",
            dataType: "text",
            success : function (data) {
                $("#parserCodeAreaID").text(data)

                addSvgDiagrams(true)

                $("#refreshSyntaxDiagrams").click(function () {
                    console.log("Refreshing the diagrams")
                    var useTokenNames = !document.getElementById('nameOrRegExp').checked;
                    addSvgDiagrams(useTokenNames)
                })
            }
        })

    })
</script>

</body>
</html>
